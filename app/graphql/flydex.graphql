fragment Mod on battlefly_mod {
  category
  class
  image
  name
  rarity
  type
}

fragment Battlefly on battlefly_flydex {
  body_color
  contest_points
  edition
  image
  league
  league_tier
  level
  location
  mods(order_by: { slot: asc }) {
    mod {
      ...Mod
    }
    slot
  }
  name
  rank
  rarity
  soulbound
  token_id
  xp
}

fragment Loadout on battlefly_win_loss_loadout {
  wl_ratio
  slot_0 {
    ...Mod
  }
  slot_1 {
    ...Mod
  }
  slot_2 {
    ...Mod
  }
  slot_3 {
    ...Mod
  }
}

fragment ModLoadout on battlefly_mod {
  slot_0_loadouts(
    limit: 1
    where: { battles: { _gte: 10 } }
    order_by: { wl_ratio: desc }
  ) {
    ...Loadout
  }
  slot_1_loadouts(
    limit: 1
    where: { battles: { _gte: 10 } }
    order_by: { wl_ratio: desc }
  ) {
    ...Loadout
  }
  slot_2_loadouts(
    limit: 1
    where: { battles: { _gte: 10 } }
    order_by: { wl_ratio: desc }
  ) {
    ...Loadout
  }
  slot_3_loadouts(
    limit: 1
    where: { battles: { _gte: 10 } }
    order_by: { wl_ratio: desc }
  ) {
    ...Loadout
  }
}

query getBattlefly($id: Int!) {
  battlefly_flydex(where: { token_id: { _eq: $id } }) {
    ...Battlefly
    stat_armor_base
    stat_armor_current
    stat_battery_base
    stat_battery_current
    stat_critical_base
    stat_critical_current
    stat_critical_damage_base
    stat_critical_damage_current
    stat_critical_resists_base
    stat_critical_resists_current
    stat_evasion_base
    stat_evasion_current
    stat_hit_points_base
    stat_hit_points_current
    stat_hit_points_regen_base
    stat_hit_points_regen_current
    stat_loot_base
    stat_loot_current
    stat_scavenge_base
    stat_scavenge_current
    stat_shield_base
    stat_shield_current
    stat_shield_regen_base
    stat_shield_regen_current
    token {
      owner
      price
      treasure_tag {
        display_name
      }
    }
    traits {
      trait {
        description
        tags
        value
      }
    }
    updated_at
    win_loss {
      battles_24h
      battles_3d
      battles_7d
      battles_today
      loadouts(order_by: { changed_at: desc }) {
        battles
        changed_at
        losses
        slot_0 {
          ...Mod
        }
        slot_1 {
          ...Mod
        }
        slot_2 {
          ...Mod
        }
        slot_3 {
          ...Mod
        }
        wins
        wl_ratio
      }
      losses_24h
      losses_3d
      losses_7d
      losses_today
      wins_24h
      wins_3d
      wins_7d
      wins_today
      wl_ratio_24h
      wl_ratio_3d
      wl_ratio_7d
      wl_ratio_today
    }
  }
  battlefly_flydex_aggregate {
    aggregate {
      max {
        rank
      }
    }
  }
}

query getCombatHistory($limit: Int!, $offset: Int!, $id: Int!) {
  battlefly_combat(
    limit: $limit
    offset: $offset
    order_by: { created_at: desc }
    where: { _or: [{ loser_id: { _eq: $id } }, { winner_id: { _eq: $id } }] }
  ) {
    created_at
    id
    location
    loser {
      token_id
      ...Battlefly
    }
    loser_slot_0_mod {
      ...Mod
    }
    loser_slot_1_mod {
      ...Mod
    }
    loser_slot_2_mod {
      ...Mod
    }
    loser_slot_3_mod {
      ...Mod
    }
    winner {
      token_id
      ...Battlefly
    }
    winner_slot_0_mod {
      ...Mod
    }
    winner_slot_1_mod {
      ...Mod
    }
    winner_slot_2_mod {
      ...Mod
    }
    winner_slot_3_mod {
      ...Mod
    }
  }
  battlefly_combat_aggregate(
    where: { _or: [{ loser_id: { _eq: $id } }, { winner_id: { _eq: $id } }] }
  ) {
    aggregate {
      count
    }
  }
}

query getFlydex(
  $limit: Int!
  $offset: Int!
  $order_by: [battlefly_flydex_order_by!]
  $where: battlefly_flydex_bool_exp
) {
  battlefly_flydex(
    limit: $limit
    offset: $offset
    order_by: $order_by
    where: $where
  ) {
    ...Battlefly
    win_loss {
      wl_ratio_24h
    }
  }
  battlefly_flydex_aggregate(where: $where) {
    aggregate {
      count
      min {
        updated_at
      }
    }
  }
}

query getFlydexFilters {
  leagues: battlefly_flydex(
    distinct_on: league_full
    order_by: { league_full: asc }
  ) {
    league_full
  }
  locations: battlefly_flydex(
    distinct_on: location
    order_by: { location: asc }
  ) {
    location
  }
  mods: battlefly_mod(order_by: { name: asc }) {
    id
    name
  }
  rarities: battlefly_flydex(distinct_on: rarity, order_by: { rarity: asc }) {
    rarity
  }
}

query getModFilters {
  categories: battlefly_mod(
    distinct_on: category
    order_by: { category: asc }
  ) {
    category
  }
  classes: battlefly_mod(distinct_on: class, order_by: { class: asc }) {
    class
  }
  leagues: battlefly_mod_league(order_by: { league: asc }) {
    league
  }
  rarities: battlefly_mod(distinct_on: rarity, order_by: { rarity: asc }) {
    rarity
  }
  types: battlefly_mod(distinct_on: type, order_by: { type: asc }) {
    type
  }
  seasons: battlefly_mod(distinct_on: season, order_by: { season: asc }) {
    season
  }
}

query getModGroup($group: String!) {
  battlefly_mod(where: { group: { _iregex: $group } }) {
    ...Mod
    ...ModLoadout
    description
    defense_armor
    defense_deploy
    defense_evasion
    defense_hp
    defense_shield
    defense_taunt
    group
    id
    season
    weapon_burst
    weapon_damage_per_fire
    weapon_damage_per_second
    weapon_deploy
    weapon_hp
    weapon_reload
  }
}

query getModList(
  $limit: Int!
  $offset: Int!
  $order_by: [battlefly_mod_order_by!]
  $where: battlefly_mod_bool_exp
) {
  battlefly_mod(
    limit: $limit
    offset: $offset
    order_by: $order_by
    where: $where
  ) {
    ...Mod
    ...ModLoadout
    equipped
    group
    id
    inventory
    leagues
    season
  }
  battlefly_mod_aggregate(where: $where) {
    aggregate {
      count
    }
  }
}

query getTraitFilters {
  tags: battlefly_trait_tag(distinct_on: tag, order_by: { tag: asc }) {
    tag
  }
}

query getTraitList(
  $limit: Int!
  $offset: Int!
  $order_by: [battlefly_trait_order_by!]
  $where: battlefly_trait_bool_exp
) {
  battlefly_trait(
    limit: $limit
    offset: $offset
    order_by: $order_by
    where: $where
  ) {
    description
    equipped
    id
    name
    tags
    value
  }
  battlefly_trait_aggregate(where: $where) {
    aggregate {
      count
    }
  }
}

query getTrending(
  $limit: Int!
  $offset: Int!
  $where: battlefly_win_loss_trending_bool_exp
) {
  battlefly_win_loss_trending(
    limit: $limit
    offset: $offset
    order_by: { rank: asc }
    where: $where
  ) {
    change
    flydex {
      ...Battlefly
      token {
        owner
        treasure_tag {
          display_name
        }
      }
      win_loss {
        wl_ratio_24h
      }
    }
    rank
    wl_ratio
    wl_ratio_previous
  }
  battlefly_win_loss_trending_aggregate(where: $where) {
    aggregate {
      count
    }
  }
}

query getTrendingTop {
  battlefly_win_loss_trending(
    distinct_on: league_full
    order_by: { league_full: asc }
  ) {
    change
    flydex {
      ...Battlefly
      win_loss {
        wl_ratio_24h
      }
    }
    wl_ratio
  }
}
